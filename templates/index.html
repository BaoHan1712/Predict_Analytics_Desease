<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>H·ªá th·ªëng H·ªó tr·ª£ Ch·∫©n ƒëo√°n B·ªánh Tim b·∫±ng AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; box-sizing: border-box; }
    .heart-beat { animation: heartbeat 1.5s ease-in-out infinite; }
    @keyframes heartbeat {
      0% { transform: scale(1); }
      14% { transform: scale(1.1); }
      28% { transform: scale(1); }
      42% { transform: scale(1.1); }
      70% { transform: scale(1); }
    }
    .medical-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .loading-spinner { border: 3px solid #f3f4f6; border-top: 3px solid #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }
    .result-card { transition: all 0.3s ease; transform: translateY(10px); opacity: 0; }
    .result-card.show { transform: translateY(0); opacity: 1; }
  </style>
</head>

<body class="bg-gray-50 min-h-full">
  <!-- Header -->
  <header class="medical-gradient text-white py-8 text-center">
    <div class="flex justify-center items-center mb-4">
      <div class="text-6xl mr-4">üè•</div>
      <div class="heart-beat text-4xl">‚ù§Ô∏è</div>
    </div>
    <h1 class="text-4xl font-bold mb-4">H·ªá th·ªëng H·ªó tr·ª£ Ch·∫©n ƒëo√°n B·ªánh Tim b·∫±ng Tr√≠ Tu·ªá Nh√¢n T·∫°o</h1>
    <p class="text-xl text-blue-100">·ª®ng d·ª•ng AI h·ªó tr·ª£ b√°c sƒ© ph√¢n t√≠ch d·ªØ li·ªáu tim m·∫°ch.</p>
  </header>

  <!-- Main -->
  <main class="max-w-7xl mx-auto px-4 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
      <!-- Form -->
      <div class="lg:col-span-3 bg-white rounded-xl shadow-lg p-6">
        <h2 class="text-2xl font-semibold mb-6 flex items-center"><span class="mr-3">üìã</span>Th√¥ng tin b·ªánh nh√¢n</h2>
        <form id="heartForm" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div><label>Tu·ªïi</label><input type="number" name="age" class="w-full p-3 border rounded-lg" required></div>
            <div><label>Gi·ªõi t√≠nh</label><select name="sex" class="w-full p-3 border rounded-lg"><option value="1">Nam</option><option value="0">N·ªØ</option></select></div>
            <div><label>Lo·∫°i ƒëau ng·ª±c</label><select name="cp" class="w-full p-3 border rounded-lg"><option value="0">Kh√¥ng</option><option value="1">ƒêi·ªÉn h√¨nh</option><option value="2">Kh√¥ng ƒëi·ªÉn h√¨nh</option><option value="3">Kh√¥ng do tim</option></select></div>
            <div><label>Huy·∫øt √°p (trestbps)</label><input type="number" name="trestbps" class="w-full p-3 border rounded-lg" required></div>
            <div><label>Cholesterol</label><input type="number" name="chol" class="w-full p-3 border rounded-lg" required></div>
            <div><label>ƒê∆∞·ªùng huy·∫øt (fbs)</label><select name="fbs" class="w-full p-3 border rounded-lg"><option value="1">Cao</option><option value="0">B√¨nh th∆∞·ªùng</option></select></div>
            <div><label>ECG (restecg)</label><select name="restecg" class="w-full p-3 border rounded-lg"><option value="0">B√¨nh th∆∞·ªùng</option><option value="1">ST-T b·∫•t th∆∞·ªùng</option><option value="2">Ph√¨ ƒë·∫°i th·∫•t tr√°i</option></select></div>
            <div><label>Nh·ªãp tim t·ªëi ƒëa (thalach)</label><input type="number" name="thalach" class="w-full p-3 border rounded-lg" required></div>
            <div><label>ƒêau khi v·∫≠n ƒë·ªông (exang)</label><select name="exang" class="w-full p-3 border rounded-lg"><option value="1">C√≥</option><option value="0">Kh√¥ng</option></select></div>
            <div><label>M·ª©c ST ch√™nh (oldpeak)</label><input type="number" step="0.1" name="oldpeak" class="w-full p-3 border rounded-lg" required></div>
            <div><label>D·ªëc ST (slope)</label><select name="slope" class="w-full p-3 border rounded-lg"><option value="0">Xu·ªëng</option><option value="1">Ph·∫≥ng</option><option value="2">L√™n</option></select></div>
            <div><label>M·∫°ch m√°u l·ªõn (ca)</label><select name="ca" class="w-full p-3 border rounded-lg"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select></div>
            <div><label>Thal</label><select name="thal" class="w-full p-3 border rounded-lg"><option value="1">B√¨nh th∆∞·ªùng</option><option value="2">C·ªë ƒë·ªãnh</option><option value="3">Ph·ª•c h·ªìi</option></select></div>
          </div>

          <div class="text-center pt-6">
            <button type="submit" id="analyzeBtn" class="bg-blue-600 hover:bg-blue-700 text-white py-3 px-8 rounded-lg flex justify-center items-center mx-auto">
              <span class="mr-2">ü©∫</span><span id="btnText">Ph√¢n t√≠ch AI</span>
              <div id="loadingSpinner" class="loading-spinner ml-3 hidden"></div>
            </button>
          </div>
        </form>
      </div>

      <!-- Result -->
      <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
        <h2 class="text-2xl font-semibold mb-4 flex items-center"><span class="mr-3">üî¨</span>K·∫øt qu·∫£ ph√¢n t√≠ch</h2>

        <div id="resultContainer" class="hidden result-card">
          <div class="p-6 rounded-lg border mb-6 text-center bg-blue-50">
            <div class="text-4xl mb-4 heart-beat">‚ù§Ô∏è</div>
            <div id="analysisDetails" class="text-left whitespace-pre-line text-gray-700 text-sm leading-relaxed max-h-[600px] overflow-y-auto px-2"></div>
          </div>
        </div>

        <div id="placeholderText" class="text-center text-gray-700 py-16">
          <div class="text-6xl mb-4">üîç</div>
          <p>Nh·∫≠p th√¥ng tin v√† nh·∫•n ‚ÄúPh√¢n t√≠ch AI‚Äù ƒë·ªÉ xem k·∫øt qu·∫£</p>
        </div>
      </div>
    </div>
  </main>

  <script>
document.getElementById('heartForm').addEventListener('submit', async e => {
  e.preventDefault();

  const analyzeBtn = document.getElementById('analyzeBtn');
  const btnText = document.getElementById('btnText');
  const loadingSpinner = document.getElementById('loadingSpinner');
  analyzeBtn.disabled = true;
  btnText.textContent = 'ƒêang ph√¢n t√≠ch...';
  loadingSpinner.classList.remove('hidden');

  const formData = new FormData(e.target);

  try {
    const res = await fetch("/predict", {
      method: "POST",
      headers: { "X-Requested-With": "XMLHttpRequest" },
      body: formData
    });
    const data = await res.json();
    console.log("üì© Response backend:", data);

    if (data.analysis_text) {
      showResult(data.analysis_text);
    } else {
      alert("‚ùå Kh√¥ng nh·∫≠n ƒë∆∞·ª£c ph·∫£n h·ªìi t·ª´ AI!");
    }

  } catch (err) {
    console.error("L·ªói:", err);
    alert("‚ö†Ô∏è Kh√¥ng th·ªÉ k·∫øt n·ªëi server!");
  } finally {
    analyzeBtn.disabled = false;
    btnText.textContent = 'Ph√¢n t√≠ch AI';
    loadingSpinner.classList.add('hidden');
  }
});

function showResult(analysisText) {
  document.getElementById('placeholderText').classList.add('hidden');
  const resultContainer = document.getElementById('resultContainer');
  const analysisDetails = document.getElementById('analysisDetails');
  resultContainer.classList.remove('hidden');
  resultContainer.classList.add('show');

  // Hi·ªÉn th·ªã text v·ªõi format xu·ªëng d√≤ng
  analysisDetails.innerHTML = analysisText
    .replace(/\n{2,}/g, "<br><br>")
    .replace(/\n/g, "<br>");
}
  </script>
</body>
</html>
